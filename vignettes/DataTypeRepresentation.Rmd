---
title: "DataType-Modality Representation"
author: "Dario Righelli"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output:
    BiocStyle::html_document:
      toc_float: true
vignette: >
    %\VignetteIndexEntry{DataType-Modality Representation}
    %\VignetteEncoding{UTF-8}
    %\VignetteEngine{knitr::rmarkdown}
Package: SingleCellMultiModal
bibliography: ../inst/REFERENCES.bib
editor_options:
  chunk_output_type: console
---

# Installation 

```{r,eval=FALSE}
if (!requireNamespace("BiocManager", quietly = TRUE))
    install.packages("BiocManager")

BiocManager::install("SingleCellMultiModal")
```


# Load libraries

```{r, include=TRUE, results="hide", message=FALSE, warning=FALSE}
library(MultiAssayExperiment)
library(SingleCellMultiModal)
library(ggplot2)
```

# Loading datasets

This step will download all the datasets present into the package, it may take 
a while if you don't have any already cached on your local machine.

```{r}
mae <- scNMT("mouse_gastrulation",
             version = "2.0.0", dry.run = FALSE)
dimexp <- lapply(experiments(mae), dim)
dimslist <- list("scNMT"=dimexp)

mae <- seqFISH(DataType="mouse_visual_cortex",
             version = "2.0.0", dry.run = FALSE)
dimexp <- lapply(experiments(mae), dim)
dimslist <- c(dimslist, list("seqFISH"=dimexp))

mae <- CITEseq(DataType="cord_blood", dry.run=FALSE)
dimexp <- lapply(experiments(mae), dim)
dimslist <- c(dimslist, list("CITEseq"=dimexp))

mae <- CITEseq(DataType="peripheral_blood", dry.run=FALSE)
dimexp <- lapply(experiments(mae), dim)
dimslist <- c(dimslist, list("ECCITEseq"=dimexp))

mae <- scMultiome("pbmc_10x", mode = "*", dry.run = FALSE, format = "MTX")
dimexp <- lapply(experiments(mae), dim)
dimslist <- c(dimslist, list("10xMultiome"=dimexp))

mae <- SCoPE2("macrophage_differentiation", dry.run = FALSE)
dimexp <- lapply(experiments(mae), dim)
dimslist <- c(dimslist, list("SCoPE2"=dimexp))
```

# Creating data structure

The following (not so elegant) code will create a `data.frame` used for the plot

```{r}

dimensions <- data.frame()
k=1
for(i in 1:length(dimslist))
{
    if ( !isEmpty(grep("scNMT", names(dimslist)[i])) )
    {
        idx <- grep("acc", names(dimslist[[i]]))
        feat <- sum(unlist(lapply(dimslist[[i]][idx], function(x) return(x[1]))))
        cells <- median(unlist(lapply(dimslist[[i]][idx], function(x) return(x[2]))))
        dimensions[k,1] <- names(dimslist)[i]
        dimensions[k,2] <- "ATAC"
        dimensions[k,3] <- feat
        dimensions[k,4] <- cells
        k <- k+1
        idx <- grep("met", names(dimslist[[i]]))
        feat <- sum(unlist(lapply(dimslist[[i]][idx], function(x) return(x[1]))))
        cells <- median(unlist(lapply(dimslist[[i]][idx], function(x) return(x[2]))))
        dimensions[k,1] <- names(dimslist)[i]
        dimensions[k,2] <- "Methylation"
        dimensions[k,3] <- feat
        dimensions[k,4] <- dimslist[[i]][[1]][2]
        k <- k+1
        idx <- grep("rna", names(dimslist[[i]]))
        dimensions[k,1] <- names(dimslist)[i]
        dimensions[k,2] <- "RNA"
        dimensions[k,3] <- dimslist[[i]][[idx]][1]
        dimensions[k,4] <- dimslist[[i]][[idx]][2]
        k <- k+1
    } 
    
    for(j in 1:length(dimslist[[i]]))
    {
        if ( !isEmpty(grep("scNMT", names(dimslist)[i])) ){ next }
        dimensions[k,1] <- names(dimslist)[i]
        dimensions[k,2] <- names(dimslist[[i]])[j]
        dimensions[k,3] <- dimslist[[i]][[j]][1]
        dimensions[k,4] <- dimslist[[i]][[j]][2]
        k <- k+1
    }
}
colnames(dimensions) <- c("DataType", "Modality", "Features", "Cells")

dimensions$Modality[grep("seqFISH", dimensions$Modality)] <- "Spatial"

dimensions$Modality[grep("rna", dimensions$Modality)] <- "RNA"
dimensions$Modality[grep("RNA", dimensions$Modality)] <- "RNA"

dimensions$Modality[grep("protein", dimensions$Modality)] <- "Protein"
dimensions$Modality[grep("atac", dimensions$Modality)] <- "ATAC"

dimensions$Modality[grep("scADT", dimensions$Modality)] <- "ADT"
dimensions$Modality[grep("scHTO", dimensions$Modality)] <- "HTO"
```


# DataType vs Modality 

The following plot shows on x-axis the datasets while on the y-axis the available
modalities.
The color code and the dot radius respectively represent the number of features 
and the number of cells per each dataset-modality combination.

```{r}

ggplot(dimensions) + 
    geom_point(aes(x=DataType, y=Modality, size=Cells, color=Features)) + 
    scale_size_continuous(range=c(3, 10)) +
    # scale_color_continuous() +
    scale_color_gradient(low="#56B4E9", high="#F0E442") +
    theme_bw()

```

